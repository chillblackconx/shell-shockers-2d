<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Shell Shokers 2D</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: white;
      text-align: center;
    }
    #menu {
      margin-top: 50px;
    }
    canvas {
      background: linear-gradient(#1a1a1a, #000);
      display: none;
      margin: 20px auto;
      border: 3px solid white;
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>Shell Shokers 2D</h1>
    <input id="username" placeholder="Pseudo">
    <br><br>
    <select id="mode">
      <option value="ffa">Tous contre tous</option>
      <option value="teams">Rouge vs Bleu</option>
    </select>
    <br><br>
    <select id="map">
      <option value="map1">Map 1</option>
      <option value="map2">Map 2</option>
    </select>
    <br><br>
    <button onclick="startGame()">Jouer</button>
  </div>

  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <!-- Charger les maps -->
  <script src="maps.html"></script>

  <script>
    let canvas, ctx;
    let player = {x:100,y:500,w:30,h:30,color:"white",vx:0,vy:0,onGround:false};
    let keys = {};
    let currentMap = [];

    function startGame(){
      document.getElementById("menu").style.display="none";
      canvas = document.getElementById("gameCanvas");
      ctx = canvas.getContext("2d");
      canvas.style.display="block";

      const mapChoice = document.getElementById("map").value;
      currentMap = maps[mapChoice];

      // écoute clavier
      window.addEventListener("keydown",e=>keys[e.key]=true);
      window.addEventListener("keyup",e=>keys[e.key]=false);

      gameLoop();
    }

    function updatePlayer(){
      const speed = 3;
      const gravity = 0.5;
      const jump = -10;

      // gauche/droite
      if(keys["ArrowLeft"] || keys["a"]) player.vx = -speed;
      else if(keys["ArrowRight"] || keys["d"]) player.vx = speed;
      else player.vx = 0;

      // saut
      if((keys["ArrowUp"] || keys["w"]) && player.onGround){
        player.vy = jump;
        player.onGround = false;
      }

      // appliquer gravité
      player.vy += gravity;

      // déplacement
      player.x += player.vx;
      player.y += player.vy;

      // collisions avec plateformes
      player.onGround = false;
      currentMap.forEach(p=>{
        if(player.x < p.x+p.w &&
           player.x+player.w > p.x &&
           player.y+player.h < p.y+player.h &&
           player.y+player.h > p.y &&
           player.vy >= 0){
          // corrige position au-dessus du bloc
          player.y = p.y - player.h;
          player.vy = 0;
          player.onGround = true;
        }
      });
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // map
      ctx.fillStyle="gray";
      currentMap.forEach(p=>{
        ctx.fillRect(p.x,p.y,p.w,p.h);
      });

      // joueur
      ctx.fillStyle=player.color;
      ctx.fillRect(player.x,player.y,player.w,player.h);
    }

    function gameLoop(){
      updatePlayer();
      draw();
      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>
