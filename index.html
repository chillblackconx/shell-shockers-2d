<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Shell Shokers 2D</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(to bottom, #222, #111);
      color: white;
      text-align: center;
      font-family: Arial, sans-serif;
    }
    #menu {
      margin-top: 50px;
    }
    canvas {
      display: none;
      margin: 20px auto;
      border: 3px solid white;
      background: #282828;
      box-shadow: 0 0 20px black;
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>ðŸ¥š Shell Shokers 2D</h1>
    <input id="username" placeholder="Pseudo">
    <br><br>
    <select id="mode">
      <option value="ffa">Tous contre tous</option>
      <option value="teams">Rouge vs Bleu</option>
    </select>
    <br><br>
    <select id="map">
      <option value="map1">Map 1</option>
      <option value="map2">Map 2</option>
    </select>
    <br><br>
    <button onclick="startGame()">Jouer</button>
  </div>

  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <!-- Charger les maps -->
  <script src="maps.html"></script>

  <script>
    let canvas, ctx;
    let player, bots = [], bullets = [];
    let keys = {};
    let currentMap = [];
    let mode = "ffa";

    function startGame(){
      document.getElementById("menu").style.display="none";
      canvas = document.getElementById("gameCanvas");
      ctx = canvas.getContext("2d");
      canvas.style.display="block";

      const mapChoice = document.getElementById("map").value;
      mode = document.getElementById("mode").value;
      currentMap = maps[mapChoice];

      // joueur principal
      player = {x:100,y:500,w:30,h:30,color:"white",vx:0,vy:0,onGround:false,hp:100,team:"white"};

      // bots selon mode
      bots = [];
      if(mode==="ffa"){
        bots.push({x:400,y:500,w:30,h:30,color:"red",vx:2,vy:0,onGround:false,hp:100,team:"red"});
        bots.push({x:600,y:500,w:30,h:30,color:"blue",vx:-2,vy:0,onGround:false,hp:100,team:"blue"});
      } else {
        bots.push({x:400,y:500,w:30,h:30,color:"red",vx:2,vy:0,onGround:false,hp:100,team:"red"});
        bots.push({x:600,y:500,w:30,h:30,color:"red",vx:-2,vy:0,onGround:false,hp:100,team:"red"});
      }

      window.addEventListener("keydown",e=>keys[e.key]=true);
      window.addEventListener("keyup",e=>keys[e.key]=false);

      gameLoop();
    }

    function physics(entity,isPlayer=false){
      const speed = 3;
      const gravity = 0.5;
      const jump = -10;

      if(isPlayer){
        if(keys["ArrowLeft"] || keys["a"]) entity.vx = -speed;
        else if(keys["ArrowRight"] || keys["d"]) entity.vx = speed;
        else entity.vx = 0;

        if((keys["ArrowUp"] || keys["w"]) && entity.onGround){
          entity.vy = jump;
          entity.onGround = false;
        }

        if(keys[" "]){
          shoot(entity);
          keys[" "] = false;
        }
      } else {
        if(entity.x < 0 || entity.x+entity.w > canvas.width){
          entity.vx *= -1;
        }
        if(entity.onGround && Math.random()<0.01){
          entity.vy = jump;
          entity.onGround=false;
        }
      }

      entity.vy += gravity;
      entity.x += entity.vx;
      entity.y += entity.vy;

      entity.onGround = false;
      currentMap.forEach(p=>{
        if(entity.x < p.x+p.w &&
           entity.x+entity.w > p.x &&
           entity.y+entity.h <= p.y+10 &&
           entity.y+entity.h >= p.y &&
           entity.vy >= 0){
          entity.y = p.y - entity.h;
          entity.vy = 0;
          entity.onGround = true;
        }
      });
    }

    function shoot(entity){
      bullets.push({
        x: entity.x+entity.w/2,
        y: entity.y+entity.h/2,
        r:5,
        color: entity.color,
        vx: entity.color==="red" ? -5 : 5,
        vy: 0,
        team: entity.team
      });
    }

    function updateBullets(){
      bullets.forEach((b,i)=>{
        b.x += b.vx;
        b.y += b.vy;

        if(b.x<0 || b.x>canvas.width) bullets.splice(i,1);

        [...bots,player].forEach(e=>{
          if(e!==undefined && e.hp>0 && b.team!==e.team &&
             b.x > e.x && b.x < e.x+e.w &&
             b.y > e.y && b.y < e.y+e.h){
            e.hp -= 20;
            bullets.splice(i,1);
          }
        });
      });
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // plateformes
      currentMap.forEach(p=>{
        ctx.fillStyle="#666";
        ctx.fillRect(p.x,p.y,p.w,p.h);
      });

      // joueur
      drawEntity(player);

      // bots
      bots.forEach(b=>drawEntity(b));

      // balles
      bullets.forEach(b=>{
        ctx.beginPath();
        ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
        ctx.fillStyle=b.color;
        ctx.fill();
      });

      // HUD
      ctx.fillStyle="white";
      ctx.fillText("HP: "+player.hp,20,20);
    }

    function drawEntity(e){
      ctx.beginPath();
      ctx.arc(e.x+e.w/2,e.y+e.h/2,e.w/2,0,Math.PI*2);
      ctx.fillStyle=e.color;
      ctx.fill();
    }

    function gameLoop(){
      if(player.hp<=0){
        alert("Game Over!");
        return;
      }

      physics(player,true);
      bots.forEach(b=>physics(b));
      updateBullets();
      draw();
      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>
