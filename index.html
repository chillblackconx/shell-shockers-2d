<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Shell Shokers 2D</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      text-align: center;
      font-family: Arial, sans-serif;
    }
    #menu {
      margin-top: 50px;
    }
    canvas {
      display: none;
      margin: 20px auto;
      border: 3px solid white;
      background: linear-gradient(#222, #000);
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>Shell Shokers 2D</h1>
    <input id="username" placeholder="Pseudo">
    <br><br>
    <select id="map">
      <option value="map1">Map 1</option>
      <option value="map2">Map 2</option>
    </select>
    <br><br>
    <button onclick="startGame()">Jouer</button>
  </div>

  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <!-- Charger les maps -->
  <script src="maps.html"></script>

  <script>
    let canvas, ctx;
    let player, bots = [];
    let keys = {};
    let currentMap = [];

    function startGame(){
      document.getElementById("menu").style.display="none";
      canvas = document.getElementById("gameCanvas");
      ctx = canvas.getContext("2d");
      canvas.style.display="block";

      const mapChoice = document.getElementById("map").value;
      currentMap = maps[mapChoice];

      // joueur
      player = {x:100,y:500,w:30,h:30,color:"white",vx:0,vy:0,onGround:false};

      // 2 bots rouges
      bots = [
        {x:400,y:500,w:30,h:30,color:"red",vx:2,vy:0,onGround:false},
        {x:600,y:500,w:30,h:30,color:"red",vx:-2,vy:0,onGround:false}
      ];

      window.addEventListener("keydown",e=>keys[e.key]=true);
      window.addEventListener("keyup",e=>keys[e.key]=false);

      gameLoop();
    }

    function physics(entity,isPlayer=false){
      const speed = 3;
      const gravity = 0.5;
      const jump = -10;

      if(isPlayer){
        // gauche/droite
        if(keys["ArrowLeft"] || keys["a"]) entity.vx = -speed;
        else if(keys["ArrowRight"] || keys["d"]) entity.vx = speed;
        else entity.vx = 0;

        // saut
        if((keys["ArrowUp"] || keys["w"]) && entity.onGround){
          entity.vy = jump;
          entity.onGround = false;
        }
      } else {
        // bots IA simple : rebond gauche/droite
        if(entity.x < 0 || entity.x+entity.w > canvas.width){
          entity.vx *= -1;
        }
        // saut aléatoire
        if(entity.onGround && Math.random()<0.01){
          entity.vy = jump;
          entity.onGround=false;
        }
      }

      // appliquer gravité
      entity.vy += gravity;

      // déplacement
      entity.x += entity.vx;
      entity.y += entity.vy;

      // collisions plateformes
      entity.onGround = false;
      currentMap.forEach(p=>{
        if(entity.x < p.x+p.w &&
           entity.x+entity.w > p.x &&
           entity.y+entity.h <= p.y+10 &&
           entity.y+entity.h >= p.y &&
           entity.vy >= 0){
          entity.y = p.y - entity.h;
          entity.vy = 0;
          entity.onGround = true;
        }
      });
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // plateformes
      ctx.fillStyle="gray";
      currentMap.forEach(p=>{
        ctx.fillRect(p.x,p.y,p.w,p.h);
      });

      // joueur
      ctx.fillStyle=player.color;
      ctx.fillRect(player.x,player.y,player.w,player.h);

      // bots
      bots.forEach(b=>{
        ctx.fillStyle=b.color;
        ctx.fillRect(b.x,b.y,b.w,b.h);
      });
    }

    function gameLoop(){
      physics(player,true);
      bots.forEach(b=>physics(b));
      draw();
      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>
